<div class="task-list-container">
  <h2 class="title">Task Management</h2>

  <div class="table-container">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

      <!-- Project Reference Column -->
      <ng-container matColumnDef="projectReference">
        <th mat-header-cell *matHeaderCellDef>Project Reference</th>
        <td mat-cell *matCellDef="let element">{{ element.projectReference }}</td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let element">{{ element.description }}</td>
      </ng-container>

      <!-- Assignee Column -->
      <ng-container matColumnDef="assignee">
        <th mat-header-cell *matHeaderCellDef>Assignee</th>
        <td mat-cell *matCellDef="let element">{{ element.assignee }}</td>
      </ng-container>

      <!-- Subteam Column -->
      <ng-container matColumnDef="subteam">
        <th mat-header-cell *matHeaderCellDef>Subteam</th>
        <td mat-cell *matCellDef="let element">{{ element.subteam }}</td>
      </ng-container>

      <!-- Priority Column -->
      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef>Priority</th>
        <td mat-cell *matCellDef="let element">
          <span [class]="getPriorityClass(element.priority)" class="priority-display">
            {{ element.priority }}
          </span>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let element">
          <select 
            *ngIf="canChangeStatus()"
            [(ngModel)]="element.status" 
            (change)="onStatusChange($event)"
            [class]="getStatusClass(element.status)"
            class="status-select"
            [attr.data-element-id]="element.id">
            <option *ngFor="let status of statusOptions" [value]="status">
              {{ status }}
            </option>
          </select>
          <span 
            *ngIf="!canChangeStatus()"
            [class]="getStatusClass(element.status)"
            class="status-display">
            {{ element.status }}
          </span>
        </td>
      </ng-container>

      <!-- Comments Column -->
      <ng-container matColumnDef="comments">
        <th mat-header-cell *matHeaderCellDef>Comments</th>
        <td mat-cell *matCellDef="let element">
          <div *ngIf="element.id && !editingComments[element.id]">
            <span *ngIf="element.comments; else noComments">{{ element.comments }}</span>
            <ng-template #noComments>
              <span class="no-comments">No comments</span>
            </ng-template>
          </div>
          <div *ngIf="element.id && editingComments[element.id]" class="comments-edit">
            <textarea 
              [(ngModel)]="tempComments[element.id]"
              class="comments-textarea"
              rows="3"
              placeholder="Enter comments...">
            </textarea>
          </div>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <!-- Subteam member actions -->
          <div *ngIf="canEditComments()" class="subteam-actions">
            <button 
              *ngIf="element.id && !editingComments[element.id]"
              mat-raised-button 
              color="primary" 
              (click)="startEditingComments(element)"
              matTooltip="Edit comments"
              class="action-button edit-comments">
              Edit Comments
            </button>
            <div *ngIf="element.id && editingComments[element.id]" class="comment-buttons">
              <button 
                mat-raised-button 
                color="primary" 
                (click)="saveComments(element)"
                matTooltip="Save comments"
                class="action-button save">
                Save
              </button>
              <button 
                mat-raised-button 
                color="warn" 
                (click)="cancelEditingComments(element)"
                matTooltip="Cancel editing"
                class="action-button cancel">
                Cancel
              </button>
            </div>
          </div>
          
          <span *ngIf="!canChangeStatus() && !canEditComments()" class="read-only-message">
            View Only
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>